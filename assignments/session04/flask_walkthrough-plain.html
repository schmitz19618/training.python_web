<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.11: http://docutils.sourceforge.net/" />
<title>A Quick Flask Walkthrough</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="a-quick-flask-walkthrough">
<h1 class="title">A Quick Flask Walkthrough</h1>

<p>If you've already set up your virtualenv and installed flask, you can simply
activate it and skip down to <strong>Kicking the Tires</strong></p>
<p>If not...</p>
<div class="section" id="practice-safe-development">
<h1>Practice Safe Development</h1>
<p>We are going to install Flask, and the packages it requires, into a
virtualenv.</p>
<p class="incremental">This will ensure that it is isolated from everything else we do in class (and
vice versa)</p>
<div class="incremental container">
<p>Remember the basic format for creating a virtualenv:</p>
<pre class="small literal-block">
$ python virtualenv.py [options] &lt;ENV&gt;
&lt;or&gt;
$ virtualenv [options] &lt;ENV&gt;
</pre>
</div>
</div>
<div class="section" id="set-up-a-virtualenv">
<h1>Set Up a VirtualEnv</h1>
<p>Start by creating your virtualenv:</p>
<pre class="literal-block">
$ python virtualenv.py flaskenv
&lt;or&gt;
$ virtualenv flaskenv
...
</pre>
<div class="incremental container">
<p>Then, activate it:</p>
<pre class="literal-block">
$ source flaskenv/bin/activate
&lt;or&gt;
C:\&gt; flaskenv\Scripts\activate
</pre>
</div>
</div>
<div class="section" id="install-flask">
<h1>Install Flask</h1>
<p>Finally, install Flask using <cite>setuptools</cite> or <cite>pip</cite>:</p>
<pre class="literal-block">
(flaskenv)$ pip install flask
Downloading/unpacking flask
  Downloading Flask-0.10.1.tar.gz (544kB): 544kB downloaded
...
Installing collected packages: flask, Werkzeug, Jinja2,
  itsdangerous, markupsafe
...
Successfully installed flask Werkzeug Jinja2 itsdangerous
  markupsafe
</pre>
</div>
<div class="section" id="kicking-the-tires">
<h1>Kicking the Tires</h1>
<p>We've installed the Flask microframework and all of its dependencies.</p>
<p class="incremental">Now, let's see what it can do</p>
<p class="incremental">With your flaskenv activated, create a file called <tt class="docutils literal">flask_intro.py</tt> and
open it in your text editor.</p>
</div>
<div class="section" id="flask">
<h1>Flask</h1>
<p>Getting started with Flask is pretty straightforward. Here's a complete,
simple app.  Type it into <cite>flask_intro.py</cite>:</p>
<pre class="code python small literal-block">
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="nd">&#64;app.route</span><span class="p">(</span><span class="s">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">'Hello World!'</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="running-our-app">
<h1>Running our App</h1>
<p>As you might expect by now, the last block in our <tt class="docutils literal">flask_intro.py</tt> file
allows us to run this as a python program. Save your file, and in your
terminal try this:</p>
<pre class="literal-block">
(flaskenv)$ python flask_intro.py
</pre>
<p class="incremental">Load <tt class="docutils literal"><span class="pre">http://localhost:5000</span></tt> in your browser to see it in action.</p>
</div>
<div class="section" id="debugging-our-app">
<h1>Debugging our App</h1>
<p>Last week, <tt class="docutils literal">cgitb</tt> provided us with useful feedback when building an app.
Flask has similar functionality. Make the following changes to your
<tt class="docutils literal">flask_intro.py</tt> file:</p>
<pre class="code python small literal-block">
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="s">'Hello World!'</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre>
<p class="incremental">Restart your app and then reload your browser to see what happens.</p>
<p>Click in the stack trace that appears in your browser.  Notice anything fun?</p>
<p>(clean up the error when you're done playing).</p>
</div>
<div class="section" id="your-work-so-far">
<h1>Your work so far</h1>
<ul class="incremental simple">
<li>You instantiated a <cite>Flask</cite> app with a name that represents the package or
module containing the app<ul>
<li>Because our app is a single Python module, this should be <tt class="docutils literal">__name__</tt></li>
<li>This is used to help the <cite>Flask</cite> app figure out where to look for
<em>resources</em></li>
</ul>
</li>
<li>You defined a function that returned a response body</li>
<li>You told the app which requests should use that function with a <em>route</em></li>
</ul>
<p class="incremental">Let's take a look at how that last bit works for a moment...</p>
</div>
<div class="section" id="url-routing">
<h1>URL Routing</h1>
<p>Remember our bookdb exercise? How did you end up solving the problem of
mapping an HTTP request to the right function?</p>
<p class="incremental">Flask solves this problem by using the <cite>route</cite> decorator from your app.</p>
<p class="incremental">A 'route' takes a URL rule (more on that in a minute) and maps it to an
<em>endpoint</em> and a <em>function</em>.</p>
<p class="incremental">When a request arrives at a URL that matches a known rule, the function is
called.</p>
</div>
<div class="section" id="url-rules">
<h1>URL Rules</h1>
<p>URL Rules are strings that represent what environ['PATH_INFO'] will look like.</p>
<p class="incremental">They are added to a <em>mapping</em> on the Flask object called the <em>url_map</em></p>
<p class="incremental">You can call <tt class="docutils literal">app.add_url_rule()</tt> to add a new one</p>
<p class="incremental">Or you can use what we've used, the <tt class="docutils literal">app.route()</tt> decorator</p>
</div>
<div class="section" id="function-or-decorator">
<h1>Function or Decorator</h1>
<pre class="code python small literal-block">
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;some function that returns something&quot;&quot;&quot;</span>
    <span class="c"># ...</span>

<span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="s">'homepage'</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</pre>
<div class="incremental container">
<p>is identical to</p>
<pre class="code python small literal-block">
<span class="nd">&#64;app.route</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="s">'homepage'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;some function that returns something&quot;&quot;&quot;</span>
    <span class="c"># ...</span>
</pre>
</div>
</div>
<div class="section" id="routes-can-be-dynamic">
<h1>Routes Can Be Dynamic</h1>
<p>A <em>placeholder</em> in a URL rule becomes a named arg to your function (add these
to <tt class="docutils literal">flask_intro.py</tt>):</p>
<pre class="code python incremental small literal-block">
<span class="nd">&#64;app.route</span><span class="p">(</span><span class="s">'/profile/&lt;username&gt;'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">show_profile</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;My username is </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">username</span>
</pre>
<p class="incremental">And <em>converters</em> ensure the incoming argument is of the correct type.</p>
<pre class="code python incremental small literal-block">
<span class="nd">&#64;app.route</span><span class="p">(</span><span class="s">'/div/&lt;float:val&gt;/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="si">%0.2f</span><span class="s"> divided by 2 is </span><span class="si">%0.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">val</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="routes-can-be-filtered">
<h1>Routes Can Be Filtered</h1>
<p>You can also determine which HTTP <em>methods</em> a given route will accept:</p>
<pre class="code python small literal-block">
<span class="nd">&#64;app.route</span><span class="p">(</span><span class="s">'/blog/entry/&lt;int:id&gt;/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,])</span>
<span class="k">def</span> <span class="nf">read_entry</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;reading entry </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">id</span>

<span class="nd">&#64;app.route</span><span class="p">(</span><span class="s">'/blog/entry/&lt;int:id&gt;/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">,</span> <span class="p">])</span>
<span class="k">def</span> <span class="nf">write_entry</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">'writing entry </span><span class="si">%d</span><span class="s">'</span> <span class="o">%</span> <span class="nb">id</span>
</pre>
<p class="incremental">After adding that to <tt class="docutils literal">flask_intro.py</tt> and saving, try loading
<tt class="docutils literal"><span class="pre">http://localhost:5000/blog/entry/23/</span></tt> into your browser. Which was called?</p>
</div>
<div class="section" id="routes-can-be-reversed">
<h1>Routes Can Be Reversed</h1>
<p>Reversing a URL means the ability to generate the url that would result in a
given endpoint being called.</p>
<p class="incremental">This means <em>you don't have to hard-code your URLs when building links</em></p>
<p class="incremental">That means <em>you can change the URLs for your app without changing code or
templates</em></p>
<p class="incremental">This is called <strong>decoupling</strong> and it is a good thing</p>
</div>
<div class="section" id="reversing-urls-in-flask">
<h1>Reversing URLs in Flask</h1>
<p>In Flask, you reverse a url with the <tt class="docutils literal">url_for</tt> function.</p>
<ul class="incremental simple">
<li><tt class="docutils literal">url_for</tt> requires an HTTP request context to work</li>
<li>You can fake an HTTP request when working in a terminal (or testing)</li>
<li>Use the <tt class="docutils literal">test_request_context</tt> method of your app object</li>
<li>This is a great chance to use the Python <tt class="docutils literal">with</tt> statement</li>
<li><strong>Don't type this</strong></li>
</ul>
<pre class="code python small incremental literal-block">
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">url_for</span>
<span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">():</span>
  <span class="k">print</span> <span class="n">url_for</span><span class="p">(</span><span class="s">'endpoint'</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="reversing-in-action">
<h1>Reversing in Action</h1>
<p>Quit your Flask app with <tt class="docutils literal">^C</tt>.  Then start a python interpreter in that same
terminal and import your <tt class="docutils literal">flask_intro.py</tt> module:</p>
<pre class="code python literal-block">
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">flask_intro</span> <span class="kn">import</span> <span class="n">app</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">url_for</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">with</span> <span class="n">app</span><span class="o">.</span><span class="n">test_request_context</span><span class="p">():</span>
<span class="o">...</span>     <span class="k">print</span> <span class="n">url_for</span><span class="p">(</span><span class="s">'show_profile'</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s">&quot;cris&quot;</span><span class="p">)</span>
<span class="o">...</span>     <span class="k">print</span> <span class="n">url_for</span><span class="p">(</span><span class="s">'divide'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">23.7</span><span class="p">)</span>
<span class="o">...</span>
<span class="s">'/profile/cris/'</span>
<span class="s">'/div/23.7/'</span>
<span class="o">&gt;&gt;&gt;</span>
</pre>
</div>
<div class="section" id="enough-for-now">
<h1>Enough for Now</h1>
<p>That will give you plenty to think about before class.  We'll put this all to
good use building a real flask app in our next session.</p>
</div>
</div>
<div class="footer">
<hr class="footer" />
<a class="reference external" href="http://github.com/cewing/training.python_web">View document source</a>.

</div>
</body>
</html>
